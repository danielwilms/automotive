<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>Gen2 - Core</title>
    <script 
      src='https://www.w3.org/Tools/respec/respec-w3c-common' 
      class='remove'></script>
    <script type="text/javascript" src="plantuml/jquery.js"></script>
    <script type="text/javascript" src="plantuml/jquery_plantuml.js"></script>
    <script type="text/javascript" src="plantuml/rawdeflate.js"></script>	 
    <script class='remove'>
      var respecConfig = {
        specStatus: "ED",
        editors: [{
          name: "Ulf Bjorkengren",
          company: "Volvo Cars",
          companyURL: "https://www.volvocars.com/intl"
        },
        {
          name: "Patrick Lünnemann",
          company: "Volkswagen Group",
          companyURL: "https://www.volkswagenag.com",
          w3cid: 95844
        },
        {
          name: "Daniel Wilms",
          company: "Bayerische Motoren Werke Aktiengesellschaft (BMW AG)",
          companyURL: "https://www.bmwgroup.com/"
        }],
        edDraftURI: "https://github.com/w3c/automotive/blob/gh-pages/spec/Gen2_Core.html",
        shortName: "Gen2-core",
        localBiblio: {
          "SemVer": {
            title: "Semantic Versioning 2.0.0",
            href: "https://semver.org/spec/v2.0.0.html",
            status: "published",
            publisher: "Tom Preston-Werner"
          }
        }
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      <p>
        This document, the Gen2 core specification, describes the Gen2 messaging layer.
        The companion specifications for the Gen2 transport protocols detail the mapping of the messaging layer to selected transports.
        The ontologies based on the Gen2 core specification are defined in documents for each specific domain
        (e.g. navigation, media, vehicle data). 
      </p>
    </section>
    <section id='sotd'></section>

    <section id="introduction">
      <h2>Introduction</h2>
      <p>
        This document describes the messaging API for Gen2 protocol. 
        This includes the messaging layer and set of rules for structuring data.
        The separation between payload encoding (transport) and messaging API (core) improves adaptability. 
        Extending and describing multiple transport protocols becomes possible.
      </p>     
      <p>
        The messages are exchanged between a <a>service</a> implementation holding the representation of data 
        and a <a>client</a> using the data.
        A <dfn>service</dfn> is an entity that manages and offers access to data.
        A <dfn>client</dfn> is an entity that works with data managed by a service.
      </p>
      <p>
        The Gen2 messaging layer uses a RESTful design for all methods exchanged via the interface (<a href="#interface"></a>).
      </p>
      <p>
        The Gen2 data structuring rules (<a href="#taxonomy"></a>) are the same through all transport protocols.
        The basis for structuring data hold by a <a>service</a> is a tree.
      </p>
    </section>

    <section id="conformance"></section>
    <section id="terms">
      <h2>Terminology</h2>
      <p>The acronym 'Gen2' is used to refer to this document, the second generation specification. The acronym 'VSS' is used to refer to the 'Vehicle Signal Specification' which is defined by the GENIVI Alliance. The term 'WebSocket' when used in this document, is as defined in the W3C WebSocket API and the WebSocket Protocol.</p>
    </section>
      
    <section id="taxonomy">
        <h2>Gen2 Multi Domain Vehicle Taxonomy</h2>
        <p>
            The Taxonomy wich is served through this interface is the Gen2 Multi Domain Taxonomy.
            It is an aggregation of different <a href="#domaintaxonomy">Domain Taxonomies</a>. 
            The single entry point and master of the Gen2 Multi Domain Taxonomy SHOULD be the 
            <a href="#vehicledomain">Vehicle Domain Taxonomy</a>.
        </p>
        
        <section id="domaintaxonomy">
            <h3>Domain Taxonomies</h3>
            <p>
                The basic structure of the taxonomy is a tree. Its goal is to formalize the 
                description of a specific domain. It consists of the <a href="#ruleset">Rule 
                Set</a>, <a href="#datadefinition">Data Definition</a> and 
                <a href="#tools">Tools</a>. 
            </p>
        </section>
        
        <section id="ruleset">
            <h3>Rule Set</h3>
            
            The Rule Set defines how to syntactically describe the taxonomy. The data structure is 
            a tree, where a leaf is understood as a nodes without children. All other nodes are 
            called branches. <a href="ruleset_branch">Branch Entries</a> represent the logical 
            structure of the domain, where <a href="rukeset_data">Data Entries</a> as leafs define 
            the actual data.
            
            <section id="ruleset_basic">
            <h4>Schema Files</h4>
                <p>
                    A domain specification MUST be written as a flat YAML list, where each signal 
                    and branch is a self-contained YAML list element. 
                </p>
                <p>
                    The YAML list is a single file, called a vspec file. A vspec can, in addition 
                    to a YAML list, also contain include directives.
                    An include directive refers to another vspec file that is to replace the 
                    directive, much like #include in C/C++. 
                </p>
                    Please note that, from a YAML perspective, the include directive is just 
                another comment.
            </section> 
            
            <section id="ruleset_branch">
                <h4>Branch Entry</h4>
                
                <div class="issue">to be described more (see 
                    <a href="http://genivi.github.io/vehicle_signal_specification/rule_set/branches/"> 
                        here</a>)</div>
                
            </section> 
            
            <section id="ruleset_data">
            <h4>Data Entry</h4>
                
                <div class="issue">to be described more (see 
                    <a href="http://genivi.github.io/vehicle_signal_specification/rule_set/data_entry/"> 
                        here</a>)</div>
                
                <section id="tree-elements">
                    <h2>Types</h2>
                    <section data-dfn-for="sensor">
                      <h3><dfn>sensor</dfn></h3>
                      <p>A leaf that describes non-static read-only signal.</p>
                    </section>
                    <section data-dfn-for="attribute">
                      <h3><dfn>attribute</dfn></h3>
                      <p>A leaf that describes static read-only value.</p>
                    </section>
                    <section data-dfn-for="stream">
                      <h3><dfn>stream</dfn></h3>
                      <p>A leaf that references a data stream, e.g. a video stream.</p>
                    </section>		
                    <section data-dfn-for="actuator">
                      <h3><dfn>actuator</dfn></h3>
                      <p>A leaf the same as <a>sensor</a> which additionaly can be changed.</p>
                    </section>
                    <section data-dfn-for="element">
                      <h3><dfn>element</dfn></h3>
                      <div class="issue">to be described</div>
                    </section>
              </section>
                
                <section id="data-types">
                    <h4>Data Types</h4>

                    <section id="number">
                      <h5><dfn>Number</dfn></h5>
                      <p>
                      <a>Number</a> is used to represent numbers. 
                      This includes all signed and unsigned integer values and floats.
                      To allow for memory allocation restrictions MUST be given.
                      Restrictions MUST be expressed by using min, max and precision.
                      Min MUST describe the lowest possible value.
                      Min MUST be defined as base to the power of min (i.e. b^min).
                      Max MUST describe the highest possible value.
                      Min MUST be defined as base to the power of max with an optional -1 (i.e. b^max - 1).
                      Precision MUST describes the smallest changeable amount in the value.
                      Precision MUST be defined as base to the power of precision (i.e. b^n). 
                      A <a>schema</a> MAY define the restrictions by using predefined restrictions.
                      <table class="def">
                        <tr><th>name</th>
                          <th>description</th>
                          <th>min</th>
                          <th>max</th>
                          <th>resolution</th></tr>
                        <tr><th><dfn>UInt8</dfn></th>
                          <td>unsigned 8-bit integer</td>
                          <td>0</td>
                          <td>255</td>
                          <td></td></tr>
                        <tr><th><dfn>Int8</dfn></th>
                          <td>signed 8-bit integer</td>
                          <td>-128</td>
                          <td>127</td>
                          <td></td></tr>
                        <tr><th><dfn>UInt16</dfn></th>
                          <td>unsigned 16-bit integer</td>
                          <td>0</td>
                          <td>65535</td>
                          <td></td></tr>
                        <tr><th><dfn>Int16</dfn></th>
                          <td>signed 16-bit integer</td>
                          <td>-32768</td>
                          <td>32767</td>
                          <td></td></tr>
                        <tr><th><dfn>UInt32</dfn></th>
                          <td>unsigned 32-bit integer</td>
                          <td>0</td>
                          <td>4294967295</td>
                          <td></td></tr>
                        <tr><th><dfn>Int32</dfn></th>
                          <td>signed 32-bit integer</td>
                          <td>-2147483648</td>
                          <td>2147483647</td>
                          <td></td></tr>
                        <tr><th><dfn>UInt64</dfn></th>
                          <td>unsigned 64-bit integer</td>
                          <td>0</td>
                          <td>2^64-1</td>
                          <td></td></tr>
                        <tr><th><dfn>Int64</dfn></th>
                          <td>signed 64-bit integer</td>
                          <td>2^63</td>
                          <td>2^63-1</td>
                          <td></td></tr>
                        <tr><th><dfn>Float</dfn></th>
                          <td>floating point number</td>
                          <td>-3.4e -38</td>
                          <td>3.4e 38</td>
                          <td></td></tr>
                        <tr><th><dfn>Double</dfn></th>
                          <td>double precision floating point number</td>
                          <td>-1.7e -300</td>
                          <td>1.7e 300</td>
                          <td></td></tr>
                        <tr><th><dfn></dfn></th>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td></tr>
                      </table>
                    </section>

                    <section id="Boolean">
                      <h3><dfn>Boolean</dfn></h3>
                      <p>Simple true or false</p>
                    </section>

                    <section data-dfn-for="String">
                        <h3><dfn>String</dfn></h3>
                        <p>
                          <a>String</a> is used to represent sequence of characters.
                          To allow for memory allocation restrictions MUST be given.
                          Restrictions MUST include a maximum string length.
                          Restrictions MAY include a character set.
                          If no character set is given unicode MUST be assumed.
                          Restrictions MAY include a regular expression.
                          <span class="issue">which regex style?</span>
                          A <a>schema</a> MAY define the restrictions by using predefined restrictions.
                          Protocol specific implementations MAY use optimized versions to transfer values with predefined restrictions. 
                        </p>
                          <table class="def">
                            <tr><th>name</th>
                              <th>description</th>
                              <th>max</th>
                              <th>example</th>
                              <th>RegEx</th></tr>
                            <tr><th><dfn>date-time</dfn></th>
                              <td>date-time (based on RFC3339 5.6) detailed fraction</td>
                              <td>29</td>
                              <td class="example">2005-11-12T12:01:42.123+01:00</td>
                              <td><code>^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?((Z|(\+|\-)\d{2}:\d{2}))$</code></td></tr>
                            <tr><th><dfn>time</dfn></th>
                              <td>time (based on RFC3339 5.6) detailed fraction</td>
                              <td>18</td>
                              <td class="example">12:01:42.123+01:00</td>
                              <td><code>^\d{2}:\d{2}:\d{2}(\.\d{3})?((Z|(\+|\-)\d{2}:\d{2}))$</code></td></tr>
                            <tr><th><dfn>date</dfn></th>
                              <td>date (RFC3339 5.6)</td>
                              <td>10</td>
                              <td class="example">2005-11-12</td>
                              <td><code>^\d{4}-\d{2}-\d{2}$</code></td></tr>
                            <tr><th><dfn></dfn></th>
                              <td></td>
                              <td></td>
                              <td class="example"></td>
                              <td><code></code></td></tr>
                          </table>
                    </section>

                    <section data-dfn-for="ByteArray">
                      <h3><dfn>ByteArray</dfn></h3>
                      <p>
                        <a>ByteArray</a>, also known as a blob, is an array of bytes of not nearer specified data.
                        To allow for memory allocation restrictions MUST be given.
                        Restrictions MUST include a maximum number of bytes.
                      </p>
                    </section>
                </section> 
            </section>
        </section>
        
        <section id="datadefinition">
            <h3>Data Definition</h3>
            <p>
                The Data Definition is the representation of a specific domain under using the <a href="#ruleset">Rule Set</a>.
            </p>
            <p>
                The Vehicle Domain Taxonomy SHOULD be the base, however it MAY be extended by taxonomies outside the vehicle signals domain. Added taxonomies MUST follow the <a href="#ruleset">defined</a> rules.
            </p>
            <section id="vehicledomain">
                <h4>Vehicle Domain Taxonomy</h4>
                It is derived from <a href="https://github.com/GENIVI/vehicle_signal_specification/blob/master/README.md">
                GENIVI's Vehicle Signal Specification</a> (VSS). It resembles the physical 
                structure of the vehicle, as shown in the
                This <a href="#tree-example">example</a>. Major vehicle structures (e.g. body, 
                engine) are near the top of the tree and the logical assemblies and components that 
                comprise them, are defined as their child nodes.
                Each of the child nodes in the tree is further decomposed into its logical 
                constituents, 
                and the process is repeated until leafs are reached.
                
                <figure id="tree-example" class="example">
                    <img uml='
                    @startuml 
                        skinparam component {
                            BorderColor Black
                            FontSize 16

                            BackgroundColor<<branch>> MediumSeaGreen
                            FontColor<<branch>> White

                            BackgroundColor<<rbranch>> Red
                            FontColor<<rbranch>> White

                            BackgroundColor<<attribute>> Yellow
                            FontColor<<attribute>> Black

                            BackgroundColor<<sensor>> CornflowerBlue
                            FontColor<<sensor>> White

                            BackgroundColor<<actuator>> DarkGrey
                            FontColor<<actuator>> White

                            BackgroundColor<<element>> LightCoral
                            FontColor<<element>> White				
                        }
                        [Vehicle] -- [Media]
                        [Vehicle] -- [Drivetrain]
                        [Vehicle] -- [Private]
                        [Vehicle]<<branch>>
                        [Media]<<branch>>
                        [Private]<<branch>>
                        [Drivetrain]<<branch>>

                        [Media] -- [Collections]
                        [Collections] .. [30321564123]
                        [Collections]<<rbranch>>
                        [30321564123]<<element>>

                        [Drivetrain] -- [Engine]
                        [Drivetrain] -- [Body]
                        [Engine]<<branch>>
                        [Body]<<branch>>

                        [Engine] -- [RPM]
                        [Engine] -- [Speed]
                        [Engine] -- [Fueltype]
                        [RPM]<<sensor>>
                        [Speed]<<sensor>>
                        [Fueltype]<<attribute>>

                        [Body] -- [Mirror]
                        [Body] -- [Door]
                        [Body] -- [Weight]
                        [Mirror]<<branch>>
                        [Door]<<branch>>
                        [Weight]<<attribute>>

                        [Door] -- [&nbsp;...&nbsp;]
                        [&nbsp;...&nbsp;]<<branch>>

                        [Mirror] -- [Left]
                        [Left] -- [Heated]
                        [Left] -- [Dimmed]
                        [Left] -- [Fold]
                        [Left]<<branch>>
                        [Right]<<branch>>
                        [Heated]<<sensor>>
                        [Dimmed]<<sensor>>
                        [Fold]<<actuator>>

                        [Mirror] -- [Right]
                        [Right] -- [ ... ]
                        [ ... ]<<branch>>

                    @enduml
                    '>
                    <figcaption>Diagram showing an example tree.</figcaption>
                </figure>
            </section>
        </section>
        <section id="tools">
            <h2>Tools</h2>
            <div class="issue">to be described more</div>
        </section>
      </section>
      

      <section data-dfn-for="address">
        <h2>Addressing</h2>
        <p>Addressing of elements is done using URIs as defined in [[RFC3986]].</p>
        <blockquote><a>scheme</a>:<a>authority</a>/<a>path</a></blockquote>
        <p>The <dfn>scheme</dfn> describes the protocol to use to reach the addressed element.
          The <dfn>authority</dfn> describes where to reach the service holding and managing the data representation.
          Scheme and authority are defined within the protocol adaptation.</p>
        <p><dfn>Path</dfn> describes the location of a specific data representation within a service.
          It is the path through the tree, the data representation, implemented by the service.</p>
      </section>
      
     
        <section data-dfn-for="Foo">
          <h2>Service discovery</h2>
          <p>The client MAY request that the server returns the VSS tree content. The client is able to request metadata from any point in the signal tree, such that only the metadata for the nodes within the given branch of the tree is returned. For example, only metadata for the chassis branch of the VSS tree is returned when the chassis path is specified. If the path is set to the VSS root, the response contains the metadata for the entire tree. If the server is able to satisfy the request it SHALL return a Response message. If an error occurs the server SHALL return an ErrorResponse message. The key data components of these messagess are defined below:</p>
          <ul>  
            <li>Request message parameters:</li>
            <ul>  
              <li>Path: The address to one or more nodes in the VSS tree, followed by the path segment "$spec".</li>
            </ul>  
            <li>Response message parameters:</li>
            <ul>  
              <li>Metadata: The content of the VSS tree where the root is specified by the path.</li>
              <li>Timestamp: A timestamp associated with the request.</li>
            </ul>  
            <li>ErrorResponse message parameters: </li>
            <ul>  
              <li>Error: Information describing the error reason.</li>
              <li>Timestamp: A timestamp associated with the failed request.</li>
            </ul>  
          </ul>  
        </section>
    </section>
	
    <section id="filter-mechanisms">
      <h2>Filtering</h2>
	  <p>
	  This section describes how to build the queries to filter for specific parts of the data representation.
	  </p> 
	  <p>A <dfn>query</dfn> is a description to taylor and filter the data resulting of a <a>read</a>.</p>
	  <p>The <a>query</a> can be given with the request from a client to a service additionally to the <a>path</a> to get a <a>content</a> response.
	  The <a>query</a> describes certain rules that filter the <a>content</a> response. 
	  <ul>
			<li>path: describing the part of the tree that shall be filtered in</li>
			<li>rules: these have to match in the nodes for the node to be part of the <a>content</a> response.</li>
	  </ul>
		</p>
		<div class="example">
		<h3>Example</h3>
			<p>
			All open doors shall be given. The tree looks as follows:
			<blockquote>
				<ul><li>/vehicle/cabin
					<ul><li>/Row1
						<ul><li>/Left
							<ul><li>/Door
								<ul>
									<li>isLocked: true</li>
									<li>open: false</li>
								</ul>
							</li></ul>
						</li></ul>
						<ul><li>/Right
							<ul><li>/Door
								<ul>
									<li>isLocked: false</li>
									<li>open: true</li>
								</ul>
							</li></ul>
						</li></ul>
					</li></ul>
					<ul><li>/Row2
						<ul><li>/Left
							<ul><li>/Door
								<ul>
									<li>isLocked: false</li>
									<li>open: false</li>
								</ul>
							</li></ul>
						</li></ul>
						<ul><li>/Right
							<ul><li>/Door
								<ul>
									<li>isLocked: true</li>
									<li>open: true</li>
								</ul>
							</li></ul>
						</li></ul>
					</li></ul>
				</li></ul>
			</blockquote>
			</p>
			<p>
			The <a>path</a> that shall be inspected is "/vehicle/cabin". <br>
			The <a>rule</a> is that "/vehicle/cabin/*/*/Door/isLocked" shall be "true".<br>
			</p>
			<p>
			The list in the <a>content</a> response would look like this:
			<blockquote>
			<ul>
			<li>/vehicle/cabin/Row1/Left/Door</li>
				<ul>
					<li>isLocked: true</li>
					<li>open: false</li>
				</ul>
			<li>/vehicle/cabin/Row2/Right/Door</li>
				<ul>
					<li>isLocked: true</li>
					<li>open: true</li>
				</ul>
			</ul>
			</blockquote>
			</p>
		</div>
     <section data-dfn-for="rules">
        <h3>Rules</h2>
		<p>
		A <dfn>rule</dfn> is an expression that describes a characteristic of nodes that shall be returned by a <a>query</a>.
		<a>Rules</a> are applied to a leaf and describe a desired attribute of a node.
		All <a>rules</a> MUST return either FALSE or TRUE.
		</p>
		<p>
		These are the <a>rules</a> that are known to check to be used in a <a>query</a> to filter <a>content</a> responses.
		
		<table border="1">
			<tr><th>name</th><th><a>input type</a></th><th>Description</th><th>Example</th></tr>
			<tr>
				<th><dfn>true</dfn></th>
				<td><a>boolean</a></td>
				<td>matches if the data value is true</td>
				<td>true(isLocked)</td>
			</tr>
			<tr>
				<th><dfn>false</dfn></th>
				<td><a>boolean</a></td>
				<td>matches if the data value is false</td>
				<td>false(isLocked)</td>
			</tr>
			<tr>
				<th><dfn>contains</dfn></th>
				<td><a>string</a></td>
				<td>matches if a given string is contained in another one</td>
				<td>contains(name, "blue")</td>
			</tr>
			<tr>
				<th><dfn>equal</dfn></th>
				<td>(<a>string</a>|<a>boolean</a>|<a>number</a>)</td>
				<td>matches if a value is equal to a given value</td>
				<td>equal(name, "Red Door")</td>
			</tr>
			<tr>
				<th><dfn>greaterThan</dfn></th>
				<td><a>number</a></td>
				<td>matches if a given number is greater than the value</td>
				<td>greaterThan(windowPosition, 0.2)</td>
			</tr>
			<tr>
				<th><dfn>smallerThan</dfn></th>
				<td><a>number</a></td>
				<td>matches if a given number is smaller than the value</td>
				<td>smallerThan(windowPosition, 0.2)</td>
			</tr>
			<tr>
				<th><dfn>greaterThanEqual</dfn></th>
				<td><a>number</a></td>
				<td>matches if a given number is greater than the value or equal to the value</td>
				<td>greaterThan(windowPosition, 0.2)</td>
			</tr>
			<tr>
				<th><dfn>smallerThanEqual</dfn></th>
				<td><a>number</a></td>
				<td>matches if a given number is smaller than the value or equal to the value</td>
				<td>smallerThan(windowPosition, 0.2)</td>
			</tr>
		</table>
		</p>
		<p>
		It MUST be possible to combine several <a>rules</a> to one greater <a>rule</a>. This is possible with the following operators.
		
		<table border="1">
			<tr>
				<th><dfn>not</dfn></th>
				<td><a>rule</a></td>
				<td>negates the return of a rule</td>
				<td>not(true(isLocked))</td>
			</tr>
			<tr>
				<th><dfn>and</dfn></th>
				<td><a>rule</a>,<a>rule</a></td>
				<td>returns true if both of the <a>rules</a> evaluates true</td>
				<td>and(ruleA,ruleB)</td>
			</tr>
			<tr>
				<th><dfn>or</dfn></th>
				<td><a>rule</a>,<a>rule</a></td>
				<td>returns true if one of the <a>rules</a> evaluates true</td>
				<td>or(ruleA,ruleB)</td>
			</tr>
		</table>
		</p>
      </section>
    </section>
 
    <section id="security">
      <h2>Security</h2>
      <div class="issue" title="describe security section">
        The security section has to be described.
        Helpful discussion might be:<br>
        Authentication: <a href="http://www.w3.org/2018/04/19-auto-minutes.html#item03">http://www.w3.org/2018/04/19-auto-minutes.html#item03</a><br>
        Volvo assesment: <a href="https://lists.w3.org/Archives/Public/public-automotive/2018Aug/0002.html">https://lists.w3.org/Archives/Public/public-automotive/2018Aug/0002.html</a>, <a href="https://www.w3.org/2018/09/25-auto-minutes.html#item01">https://www.w3.org/2018/09/25-auto-minutes.html#item01</a>
      </div>
    </section>

    <section data-dfn-for="interface">
      <h2>Interface</h2>
      <p>
        This chapter describes the different methods and its arguments that govern the communication between a <a>service</a> and a <a>client</a>.
      </p>
      <section data-dfn-for="methods">
        <h2>Methods</h2>
        <p>
          A timeout for the response of all methods with responses MUST be defined.
          This timeout is transport protocol specific to reflect the normal behaviour of the transport protocol.
        </p>
        <div class="issue" title="error types for methods">All methods should list the possible error types returned.</div>
        <section data-dfn-for="read">
          <h2><dfn>read</dfn></h2>
          <p>Purpose: obtain a representation of the value addressed by the given path</p>
          <p>The service MUST expose a <a>read</a> method.
             The client MAY use the <a>read</a> method of the service to retrieve values managed by the service. 
             If the service is able to satisfy the request it MUST return a <a>content</a> response.
             If the service is unable to fulfil the request, then the service MUST return an <a>error</a> response.
             The client MAY have to authenticate via the <a>authenticate</a> method before being able to access the values.</p>
          <p>arguments: 
          <ul>
            <li><a>path</a> fully qualified path to a base node</li>
            <li><a>filter</a> selection criterias for specific values under the given <a>path</a></li>
          </ul>
          </p>
          <p>responses:
            <ul>  
              <li><a>content</a> response fulfilling the request</li>
              <li><a>error</a> response describing what went wrong</li>
            </ul>
          </p>
        </section>
        <section data-dfn-for="update">
          <h2><dfn>update</dfn></h2>
          <p>Purpose: providing altered values to the service for a specified <a>path</a></p>
          <p>The service MAY expose an <a>update</a> method.
             The client MAY use the <a>update</a> method of the service to request a change to values managed by the service. 
             If the service is able to satisfy the request it MUST return a <a>change</a> response. 
             If an error occurs the service MUST return an <a>error</a> response.</p>
          <p>arguments: 
            <ul>
              <li><a>path</a> fully qualified path to a base node</li>
              <li><a>filter</a> selection criterias for specific values under the given <a>path</a></li>
              <li><a>change</a> new value that shall be applied</li>
            </ul>
          </p>
          <p>responses:
            <ul>  
              <li><a>change</a> response describing what went well</li>
              <li><a>error</a> response describing what went wrong</li>
            </ul>
          </p>
        </section>
        <section data-dfn-for="create">
          <h2><dfn>create</dfn></h2>
          <p>Purpose: providing new values to the service under a specified <a>path</a></p>
          <p>The service MAY expose a <a>create</a> method.
             The client MAY use the <a>create</a> method of the service to request new values to be managed by the service. 
             If the service is able to satisfy the request it MUST return a <a>change</a> response. 
             If an error occurs the service MUST return an <a>error</a> response.</p>
          <p>arguments: 
            <ul>
              <li><a>path</a> fully qualified path to a base node</li>
              <li><a>change</a> new value that shall be added</li>
            </ul>
          </p>
          <p>responses:
            <ul>  
              <li><a>change</a> response describing what went well</li>
              <li><a>error</a> response describing what went wrong</li>
            </ul>
          </p>
        </section>
        <section data-dfn-for="delete">
          <h2><dfn>delete</dfn></h2>
          <p>Purpose: removing all selected values under a specified <a>path</a></p>
          <p>The service MAY expose a <a>delete</a> method.
             The client MAY use the <a>delete</a> method of the service to request the deletion of existing values managed by the service.
             If the service is able to satisfy the request it MUST return a <a>change</a> response. 
             If an error occurs the service MUST return an <a>error</a> response.</p>
          <p>arguments: 
            <ul>
              <li><a>path</a> fully qualified path to a base node</li>
              <li><a>filter</a> selection criterias for specific values under the given <a>path</a></li>
            </ul>
          </p>
          <p>responses:
            <ul>  
              <li><a>change</a> response describing what went well</li>
              <li><a>error</a> response describing what went wrong</li>
            </ul>
          </p>
        </section>
        <section data-dfn-for="subscribe">
          <h2><dfn>subscribe</dfn></h2>
          <p>Purpose: monitor changes made to values under a specified <a>path</a></p>
          <p>The service MAY expose a <a>subscribe</a> method.
             The client MAY use the <a>subscribe</a> method of the service to request being informed of changes made to values managed by the service.
             The service MUST issue a notification if the equivalent <a>read</a> <a>content</a> response would change.
             If the service is able to satisfy the request it MUST return a <a>subscription</a> and <a>contract</a> response.
             If an error occurs the service MUST return an <a>error</a> response.</p>
          <p>arguments: 
            <ul>
              <li><a>path</a> fully qualified path to a base node</li>
              <li><a>filter</a> selection criterias for specific values under the given <a>path</a></li>
              <li><a>contract</a> describing the expectations for the client receiving notifications</li>
            </ul>
          </p>
          <p>responses:
            <ul>  
              <li><a>subscription</a> response describing the status of the subscription</li>
              <li><a>contract</a> describing the rules for the service sending notifications to the client</li>
              <li><a>error</a> response describing what went wrong</li>
            </ul>
          </p>
        </section>
        <section data-dfn-for="notify">
          <h2><dfn>notify</dfn></h2>
          <p>Purpose: informs of changes made to values under a <a>subscription</a></p>
          <p>The client MUST expose a <a>notify</a> method if it uses the <a>subscribe</a> method of a service.
             The service MUST use the <a>notify</a> method of the client to inform of changes made to values managed by the service under the given <a>subscription</a> by sending a <a>content</a> response.
             The service MUST ignore any response from the client. 
          </p>
          <p>arguments: 
            <ul>
              <li><a>subscription</a> identifying the subscription</li>
              <li><a>content</a> response fulfilling the request</li>
            </ul>
          </p>
          <p>responses: none</p>
        </section>
        <section data-dfn-for="unsubscribe">
          <h2><dfn>unsubscribe</dfn></h2>
          <p>Purpose: stop monitoring the changes made to values under a <a>subscription</a></p>
          <p>The service MUST expose a <a>unsubscribe</a> method if an <a>subscribe</a> method is exposed.
             The client MAY use the <a>unsubscribe</a> method of the service to cancel being informed of changes made to values managed by the service under the given <a>subscription</a>.
             The service MUST stop issuing notifications.
             If the service is able to satisfy the request it MUST return a <a>subscription</a> response.
             If an error occurs the service MUST return an <a>error</a> response.</p>
          <p>arguments: 
            <ul>
              <li><a>subscription</a> identifying the subscription</li>
            </ul>
          </p>
          <p>responses:
            <ul>  
              <li><a>subscription</a> response describing the status of the subscription</li>
              <li><a>error</a> response describing what went wrong</li>
            </ul>
          </p>
        </section>
      </section>
      <section data-dfn-for="arguments-and-responses">
        <h2>Arguments and Responses</h2>
        <section data-dfn-for="content-response">
          <h2><dfn>content</dfn></h2>
          <ul>  
            <li>Value: One or more values associated with the addressed VSS leaves.</li>
            <li>Timestamp: A timestamp associated with the request.</li>
          </ul>  
        </section>
        <section data-dfn-for="filter">
          <h2><dfn>filter</dfn></h2>
          criterias to filter according to a query
        </section>
        <section data-dfn-for="path">
          <h2><dfn>path</dfn></h2>
          see addressing
        </section>
        <section data-dfn-for="change">
          <h2><dfn>change</dfn></h2>
          <ul>
            <li>changed applied immediately or later</li>
            <li>list changed paths</li>
          </ul>  
        </section>
        <section data-dfn-for="subscription">
          <h2><dfn>subscription</dfn></h2>
          status of the subscription
        </section>
        <section data-dfn-for="contract">
          <h2><dfn>contract</dfn></h2>
          describing the rules for subscriptions/notifications
        </section>
        <section data-dfn-for="error">
        <h2><dfn>error</dfn></h2>
          <p>
            An <a>error</a> response MUST include the formal error type.
            An <a>error</a> response MAY include a textual form of the error type. 
            An <a>error</a> response MUST include an error value if obligatory for the error type.
            An <a>error</a> response MUST include a timestamp.
            An <a>error</a> response MUST be actionable.
            <table class="def">
              <tr>
                <th>field</th><th>obligation</th><th>description</th><th>format</th><th>example</th></tr>
              <tr>
                <th>error type</th>
                <td>mandatory</td>
                <td>short handle describing the error.</td>
                <td>protocol specifc</td>
                <td>AuthorizationFailed</td>
              </tr>
              <tr>
                <th>error description</th>
                <td>optional</td>
                <td>Information describing the error reason.</td>
                <td><code>^[\w ]{5,255}$</code></td>
                <td>
                  Authorization failed for the method. 
                  Please set a valid AuthToken and AuthType.
                </td>
              </tr>
              <tr>
                <th>error value</th>
                <td>conditional</td>
                <td>
                  Send if set as mandatory for the error type. 
                  Describing more details to understand the error type.
                </td>
                <td>string, error type specific</td>
                <td>AuthToken valid; Access Level not sufficient.</td>
              </tr>
              <tr>
                <th>timestamp</th>
                <td>mandatory</td>
                <td>The time when the error occured.</td>
                <td><a>date-time</a> compliant</td>
                <td>2005-11-12T12:01:42.123+01:00</td>
              </tr>
            </table>
            <div class="issue" title="error value">Do we really need an error value as all method calls are directly mapped to error response.</div>
            <div class="issue" title="timestamps">How do we want to handle timestamps? Is this something that is signaled through the meta-data for the call of the method? Is this something every method must have?</div>
          </p>
          <section data-dfn-for="error-types">
            <h3>Error Types</h3>
            <p>
              These error types MUST be implemented by a <a>service</a>.
              A transport protocol MAY define additional error types.
              A transport protocol MUST not alter these error types.
            </p>
            <table class="def">
              <tr><th>error type</th><th>Textual description</th><th>values</th><th>Solution/Action</th></tr>
              <tr>
                <th>InvalidToken</th>
                <td>The AuthToken is not recognized as valid.</td>
                <td>none</td>
                <td>Check if AuthType is set correctly. Get a new AuthToken.</td>
              </tr>
              <tr>
                <th>AccessLevelNotSufficient</th>
                <td>The AuthToken is recognized but does not allow the execution of the requested method.</td>
                <td>none</td>
                <td>Get a token with a different access level.</td>
              </tr>
              <tr>
                <th>InvalidPath</th>
                <td>The given path is not valid.</td>
                <td>none</td>
                <td>Check the path given in the arguments.</td>
              </tr>
              <tr>
                <th>MissingArgument</th>
                <td>An mandatory argument is missing from the method execution.</td>
                <td>Missing Argument</td>
                <td>Add missing argument.</td>
              </tr>
              <tr>
                <th>InvalidFilter</th>
                <td>Filter could not be parsed.</td>
                <td>Error Position</td>
                <td>Fix filter.</td>
              </tr>
              <tr>
                <th>ValueNotPermited</th>
                <td>A value set by the client is not permited.</td>
                <td>value</td>
                <td>Set the value to a value permited by the service implementation.</td>
              </tr>
              <tr>
                <th>ContractInvalid</th>
                <td>The contract submitted is not valid.</td>
                <td>Invalid contract statement</td>
                <td>Recall method with a valid contract.</td>
              </tr>
              <tr>
                <th>SubscriptionUnknown</th>
                <td>The subscription is not known by the service.</td>
                <td>none</td>
                <td>Check subscription.</td>
              </tr>
              <tr>
                <th></th>
                <td></td>
                <td></td>
                <td></td>
              </tr>
            </table>
            <div class="issue" title="error type examples">Would examples for the error types be helpful?</div>
            <div class="issue" title="error type location">Where best to describe error types?</div>
          </section>
        </section>
        
      </section>
      <section data-dfn-for="headers">
        <h3>Meta-Data</h3>
        <div class="issue" title="naming: headers/meta-data">
          The title for this chapter is not good.
        </div>
        <p>
          For the communication between service and client several key/value pairs can be given to describe the environment in what the methods (<a href="#methods"></a>) are called.
          The string describing the key MUST be the same structure as <a>name</a>.
        </p>
        
        <section data-dfn-for="authorization">
          <h4><dfn>authorization</dfn></h4>
          <p>Purpose: <a>authorization</a> makes it possible for a client to authorize itself towards a service.</p>
          <p>
            The <a>authorization</a> key/value pairs consists out of a <a>AuthType</a> and a <a>AuthToken</a> key/value pair.
            The client MAY use the <a>authorization</a> key/value pairs to transfer an authorization token to the service.
            The client MUST use either both key/value pairs or none of the two.
            The service MAY use the token transfered by the <a>AuthToken</a> key/value pair to authenticate the client.
            The client MUST set the type of the token with the <a>AuthType</a> key/value pair if <a>AuthToken</a> is set.
            This concept MAY be used for access control.
            A rejected authorization token MUST result in an <a>error</a> response.
            If the execution of a method on a service needs authorization the service MUST use the authorization key/value pair.
            <table class="def">
              <tr><th>key</th>    <td><dfn>AuthToken</dfn></td></tr>
              <tr><th>value</th>  <td><code>^\w{1,1024}$</code></td></tr>
            </table>
            <div class="issue" title="max length AuthToken">How long should the maximum length of a token be to be easily implemented by most protocols.</div>
            <table class="def">
              <tr><th>key</th>    <td><dfn>AuthType</dfn></td></tr>
              <tr><th>value</th>  <td><a>name</a> compliant</td></tr>
            </table>
          </p>
        </section>
        
        <section id="variant-selection">
          <h4>variant selection</h4>
          <p>
            Purpose: 
            A client can express which schema variants it can support when executing a method.
            A service can express which schema variant it uses when communicating with the client.
          </p>
          <p>
            The client MAY set multiple key/value pairs to describe all variants it supports.
            The client MAY not set any key/value pair.
            The service MUST set exactly one schema key/value pair to describe the used variant.
            The client MAY use the [[SemVer]] style to describe degrees of freedom in the version of the schema.
            <table class="def">
              <tr><th>key</th>    <td>Schema</td></tr>
              <tr><th>value</th>  <td><a>schema</a> compliant</td></tr>
              <tr><th>example</th><td>w3c.vehicle.v1.5.3</td></tr>
            </table>
          </p>
        </section>
        
      </section>
    </section>

    <section id="issue-summary" class="appendix"></section>
    <section id="tof" class="appendix"></section>
  </body>
</html>